{"ast":null,"code":"var _jsxFileName = \"/Users/ayoubsadour/Desktop/last-version-main/frontend/src/components/MachineCard.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst statusColors = {\n  working: 'green',\n  maintenance: 'blue',\n  stop: 'red'\n};\nexport default function MachineCard({\n  machine\n}) {\n  _s();\n  const [status, setStatus] = useState(machine.status);\n  const [stoppedDuration, setStoppedDuration] = useState(null);\n  useEffect(() => {\n    const fetchHistory = async () => {\n      const serverIP = window.location.protocol + '//' + window.location.hostname;\n      const res = await axios.get(`${serverIP}:5000/api/machines/${machine.id}/history`);\n      const history = res.data;\n      // Find the last period where status was 'stop' before switching to 'working'\n      let lastStoppedStart = null;\n      let lastStoppedEnd = null;\n      for (let i = history.length - 1; i >= 0; i--) {\n        if (history[i].status === 'working' && lastStoppedStart === null) {\n          lastStoppedEnd = history[i].timestamp;\n        }\n        if (history[i].status === 'stop' && lastStoppedEnd !== null) {\n          lastStoppedStart = history[i].timestamp;\n          break;\n        }\n      }\n      if (lastStoppedStart && lastStoppedEnd) {\n        const durationMs = lastStoppedEnd - lastStoppedStart;\n        setStoppedDuration(durationMs);\n      } else {\n        setStoppedDuration(null);\n      }\n    };\n    fetchHistory();\n  }, [machine.id, status]);\n  const handleChange = async e => {\n    const newStatus = e.target.value;\n    setStatus(newStatus);\n    const serverIP = window.location.protocol + '//' + window.location.hostname;\n    await axios.put(`${serverIP}:5000/api/machines/${machine.id}/status`, {\n      status: newStatus\n    });\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      border: `2px solid ${statusColors[status]}`,\n      borderRadius: 8,\n      padding: 16,\n      minWidth: 180,\n      background: '#fff'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n      children: machine.name\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 56,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n      value: status,\n      onChange: handleChange,\n      children: [/*#__PURE__*/_jsxDEV(\"option\", {\n        value: \"working\",\n        children: \"Working\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 58,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n        value: \"maintenance\",\n        children: \"Under maintenance\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 59,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n        value: \"stop\",\n        children: \"Stop\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 60,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 57,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        color: statusColors[status],\n        marginTop: 8\n      },\n      children: [status === 'working' && 'En fonctionnement', status === 'maintenance' && 'Under maintenance', status === 'stop' && 'Arrêtée']\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 62,\n      columnNumber: 7\n    }, this), stoppedDuration !== null && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginTop: 8,\n        color: '#555',\n        fontSize: 13\n      },\n      children: [\"Last stopped duration: \", Math.floor(stoppedDuration / 60000), \" min \", Math.floor(stoppedDuration % 60000 / 1000), \" sec\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 49,\n    columnNumber: 5\n  }, this);\n}\n_s(MachineCard, \"s0wJ/qiCqcncpmA2EmesjyIFOi8=\");\n_c = MachineCard;\nvar _c;\n$RefreshReg$(_c, \"MachineCard\");","map":{"version":3,"names":["React","useState","useEffect","axios","jsxDEV","_jsxDEV","statusColors","working","maintenance","stop","MachineCard","machine","_s","status","setStatus","stoppedDuration","setStoppedDuration","fetchHistory","serverIP","window","location","protocol","hostname","res","get","id","history","data","lastStoppedStart","lastStoppedEnd","i","length","timestamp","durationMs","handleChange","e","newStatus","target","value","put","style","border","borderRadius","padding","minWidth","background","children","name","fileName","_jsxFileName","lineNumber","columnNumber","onChange","color","marginTop","fontSize","Math","floor","_c","$RefreshReg$"],"sources":["/Users/ayoubsadour/Desktop/last-version-main/frontend/src/components/MachineCard.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport axios from 'axios';\n\nconst statusColors = {\n  working: 'green',\n  maintenance: 'blue',\n  stop: 'red'\n};\n\nexport default function MachineCard({ machine }) {\n  const [status, setStatus] = useState(machine.status);\n  const [stoppedDuration, setStoppedDuration] = useState(null);\n\n  useEffect(() => {\n    const fetchHistory = async () => {\n      const serverIP = window.location.protocol + '//' + window.location.hostname;\n      const res = await axios.get(`${serverIP}:5000/api/machines/${machine.id}/history`);\n      const history = res.data;\n      // Find the last period where status was 'stop' before switching to 'working'\n      let lastStoppedStart = null;\n      let lastStoppedEnd = null;\n      for (let i = history.length - 1; i >= 0; i--) {\n        if (history[i].status === 'working' && lastStoppedStart === null) {\n          lastStoppedEnd = history[i].timestamp;\n        }\n        if (history[i].status === 'stop' && lastStoppedEnd !== null) {\n          lastStoppedStart = history[i].timestamp;\n          break;\n        }\n      }\n      if (lastStoppedStart && lastStoppedEnd) {\n        const durationMs = lastStoppedEnd - lastStoppedStart;\n        setStoppedDuration(durationMs);\n      } else {\n        setStoppedDuration(null);\n      }\n    };\n    fetchHistory();\n  }, [machine.id, status]);\n\n  const handleChange = async (e) => {\n    const newStatus = e.target.value;\n    setStatus(newStatus);\n    const serverIP = window.location.protocol + '//' + window.location.hostname;\n    await axios.put(`${serverIP}:5000/api/machines/${machine.id}/status`, { status: newStatus });\n  };\n\n  return (\n    <div style={{\n      border: `2px solid ${statusColors[status]}`,\n      borderRadius: 8,\n      padding: 16,\n      minWidth: 180,\n      background: '#fff'\n    }}>\n      <h4>{machine.name}</h4>\n      <select value={status} onChange={handleChange}>\n        <option value=\"working\">Working</option>\n        <option value=\"maintenance\">Under maintenance</option>\n        <option value=\"stop\">Stop</option>\n      </select>\n      <div style={{ color: statusColors[status], marginTop: 8 }}>\n        {status === 'working' && 'En fonctionnement'}\n        {status === 'maintenance' && 'Under maintenance'}\n        {status === 'stop' && 'Arrêtée'}\n      </div>\n      {stoppedDuration !== null && (\n        <div style={{ marginTop: 8, color: '#555', fontSize: 13 }}>\n          Last stopped duration: {Math.floor(stoppedDuration / 60000)} min {Math.floor((stoppedDuration % 60000) / 1000)} sec\n        </div>\n      )}\n    </div>\n  );\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}